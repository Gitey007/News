<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Location News | Ultra Smooth</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap"
      rel="stylesheet"
    />

    <style>
      /* --- 1. Base Setup --- */
      :root {
        --primary: #6c63ff;
        --secondary: #2a2d3e;
        --accent: #00d2ff;
        --glass: rgba(255, 255, 255, 0.1);
        --glass-border: rgba(255, 255, 255, 0.2);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        -webkit-tap-highlight-color: transparent; /* Removes blue tap highlight on mobile */
      }

      body {
        font-family: "Outfit", sans-serif;
        background: #0f0c29;
        background: linear-gradient(to right, #24243e, #302b63, #0f0c29);
        /* Use dvh for mobile browsers to account for URL bar */
        min-height: 100vh;
        min-height: 100dvh;
        display: flex;
        flex-direction: column;
        align-items: center;
        /* Responsive top padding */
        padding-top: clamp(20px, 5vh, 60px);
        padding-bottom: 20px;
        color: #fff;
        overflow-x: hidden;
      }

      /* --- 2. Animated Background Particles --- */
      .bg-animation {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: -1;
        pointer-events: none; /* Ensure clicks pass through */
      }
      .bg-animation li {
        position: absolute;
        display: block;
        list-style: none;
        width: 20px;
        height: 20px;
        background: rgba(255, 255, 255, 0.05);
        animation: floatUp 25s linear infinite;
        bottom: -150px;
        border-radius: 50%;
      }
      /* Randomize positions & speeds */
      .bg-animation li:nth-child(1) { left: 25%; width: 80px; height: 80px; animation-delay: 0s; }
      .bg-animation li:nth-child(2) { left: 10%; width: 20px; height: 20px; animation-delay: 2s; animation-duration: 12s; }
      .bg-animation li:nth-child(3) { left: 70%; width: 20px; height: 20px; animation-delay: 4s; }
      .bg-animation li:nth-child(4) { left: 40%; width: 60px; height: 60px; animation-delay: 0s; animation-duration: 18s; }
      .bg-animation li:nth-child(5) { left: 65%; width: 20px; height: 20px; animation-delay: 0s; }

      @keyframes floatUp {
        0% { transform: translateY(0) rotate(0deg); opacity: 0.8; }
        100% { transform: translateY(-1000px) rotate(720deg); opacity: 0; }
      }

      /* --- 3. Main Glass Container --- */
      main {
        /* Width adapts to screen size */
        width: 92%; 
        max-width: 800px;
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid var(--glass-border);
        border-radius: 24px;
        /* Clamp padding: 20px on mobile, scaling up to 40px on desktop */
        padding: clamp(20px, 4vw, 40px);
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        animation: slideDown 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
        margin-bottom: 20px;
      }

      @keyframes slideDown {
        from { opacity: 0; transform: translateY(-30px); }
        to { opacity: 1; transform: translateY(0); }
      }

      /* --- 4. Header & Typography --- */
      h1 {
        text-align: center;
        margin-bottom: 30px;
        /* Responsive font size: minimum 1.8rem, ideal 5vw, max 2.5rem */
        font-size: clamp(1.8rem, 5vw, 2.5rem);
        background: linear-gradient(90deg, #fff, #a29bfe);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        letter-spacing: -1px;
      }

      /* --- 5. Interactive Search Bar --- */
      .search-wrapper {
        position: relative;
        display: flex;
        justify-content: center;
        margin-bottom: 40px;
      }

      .search-box {
        display: flex;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50px;
        padding: 8px;
        width: 100%;
        max-width: 500px;
        transition: all 0.3s ease;
        border: 1px solid transparent;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .search-box:focus-within {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.3);
        transform: scale(1.02);
        box-shadow: 0 8px 25px rgba(108, 99, 255, 0.25);
      }

      input {
        flex: 1;
        border: none;
        background: transparent;
        padding: 12px 20px;
        font-size: 16px;
        color: #fff;
        font-family: inherit;
        outline: none;
        min-width: 0; /* Prevents input from breaking flexbox on tiny screens */
      }

      input::placeholder {
        color: rgba(255, 255, 255, 0.5);
      }

      button {
        padding: 12px 30px;
        border: none;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        color: #fff;
        font-weight: 600;
        border-radius: 30px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(108, 99, 255, 0.3);
        white-space: nowrap; /* Prevent button text wrapping */
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(108, 99, 255, 0.5);
      }

      button:active {
        transform: translateY(1px);
      }

      /* Mobile Specific Tweaks */
      @media (max-width: 480px) {
        .search-box {
            padding: 4px; /* Less padding to give input more room */
        }
        input {
            font-size: 16px; /* Prevents iOS zoom on focus */
            padding: 10px 15px;
        }
        button {
            padding: 10px 20px; /* Smaller button on mobile */
            font-size: 0.9rem;
        }
      }

      /* Shake Animation for Errors */
      .shake {
        animation: shake 0.4s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
        border-color: #ff6b6b;
      }
      @keyframes shake {
        10%, 90% { transform: translate3d(-1px, 0, 0); }
        20%, 80% { transform: translate3d(2px, 0, 0); }
        30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
        40%, 60% { transform: translate3d(4px, 0, 0); }
      }

      /* --- 6. News Cards --- */
      .news-container {
        display: grid;
        gap: 20px;
      }

      .article {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.05);
        padding: 20px;
        border-radius: 16px;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .article.visible {
        opacity: 1;
        transform: translateY(0);
      }

      .article:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .article h3 a {
        color: #fff;
        text-decoration: none;
        font-size: 1.2rem;
        display: block;
        margin-bottom: 8px;
        background: linear-gradient(90deg, #fff, #fff);
        background-size: 0% 2px;
        background-repeat: no-repeat;
        background-position: left bottom;
        transition: background-size 0.3s ease;
        padding-bottom: 2px;
      }

      .article:hover h3 a {
        background-size: 100% 2px;
      }

      .article small {
        display: inline-block;
        background: rgba(108, 99, 255, 0.2);
        color: #a29bfe;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        margin-bottom: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .article p {
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.95rem;
        line-height: 1.6;
      }

      /* --- 7. Loading Spinner --- */
      .loader {
        display: none;
        width: 40px;
        height: 40px;
        border: 4px solid rgba(255, 255, 255, 0.1);
        border-left-color: var(--accent);
        border-radius: 50%;
        margin: 20px auto;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        100% { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body>
    <ul class="bg-animation">
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
    </ul>

    <main>
      <h1>Global Feed</h1>

      <div class="search-wrapper">
        <div class="search-box" id="searchBox">
          <input
            type="text"
            id="locationInput"
            placeholder="Search location (e.g., Tokyo)..."
            autocomplete="off"
            spellcheck="false"
          />
          <button onclick="getNews()">Explore</button>
        </div>
      </div>

      <div id="loader" class="loader"></div>
      <div id="newsContainer" class="news-container"></div>
    </main>

    <script>
      // Points to your local backend
      const API_URL = "/api/news";

      async function getNews() {
        const locationInput = document.getElementById("locationInput");
        const searchBox = document.getElementById("searchBox");
        const container = document.getElementById("newsContainer");
        const loader = document.getElementById("loader");
        const location = locationInput.value.trim();

        container.innerHTML = "";
        searchBox.classList.remove("shake");
        // Remove focus from input to hide mobile keyboard after search
        locationInput.blur(); 

        if (!location) {
          void searchBox.offsetWidth;
          searchBox.classList.add("shake");
          return;
        }

        loader.style.display = "block";

        try {
          const res = await fetch(
            `${API_URL}?q=${encodeURIComponent(location)}`
          );

          if (!res.ok) throw new Error("Server error");

          const data = await res.json();
          loader.style.display = "none";

          if (data.articles && data.articles.length > 0) {
            data.articles.slice(0, 10).forEach((article, index) => {
              if (article.title === "[Removed]") return;

              const div = document.createElement("div");
              div.className = "article";

              const date = new Date(article.publishedAt).toLocaleDateString(
                undefined,
                { year: "numeric", month: "short", day: "numeric" }
              );

              div.innerHTML = `
              <h3><a href="${article.url}" target="_blank" rel="noopener noreferrer">${article.title}</a></h3>
              <small>${article.source.name} â€¢ ${date}</small>
              <p>${article.description || "No description available. Click the title to read the full story."}</p>
            `;

              container.appendChild(div);

              setTimeout(() => {
                div.classList.add("visible");
              }, index * 100);
            });
          } else {
            container.innerHTML = `<p style="text-align:center; color:rgba(255,255,255,0.6);">No news found for "${location}".</p>`;
          }
        } catch (err) {
          loader.style.display = "none";
          console.error(err);
          container.innerHTML = `
          <div style="text-align:center; padding:20px; background:rgba(255,0,0,0.1); border-radius:10px;">
            <p style="color:#ff6b6b; margin-bottom:5px;">Connection Failed</p>
            <p style="font-size:0.8rem; color:rgba(255,255,255,0.6);">Ensure 'node server.js' is running.</p>
          </div>
        `;
        }
      }

      document
        .getElementById("locationInput")
        .addEventListener("keypress", (e) => {
          if (e.key === "Enter") getNews();
        });
    </script>
  </body>
</html>